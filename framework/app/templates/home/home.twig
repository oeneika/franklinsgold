{% extends 'overall/layout' %}
{% block appBody %}
<div id="page-wrapper" class="gray-bg" onload="">
<div class="row border-bottom">
    {% include 'overall/header' %}
</div>
    <div class="wrapper wrapper-content">

        {% if owner_user.id_comercio_afiliado != null and owner_user.tipo == 3 %}
        <div class="row">        
            <div class="col-md-12">
                <a onclick="showModal({{precio_oro_global.precio_dolares_venta}},{{precio_plata_global.precio_dolares_venta}},{{ precio_bolivar }},'enviogramosModal')" class="btn btn-warning btn-rounded" style="float:right; margin-bottom:10px;margin-left:5px;">
                    <i class="fa fa-check"></i>Enviar gramos
                </a>          
            </div>   
        </div>
        {% endif %}

        {% if owner_user.tipo != 1 %}
        <div class="row">
            <div class="col-md-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                            <div>
                                <span class="pull-right text-right">
                                <small>Cotización en tiempo real del precio del oro en el mercado al contado</small>
                                </span>
                                <h3 class="font-bold no-margins">
                                    Precio del oro (En dólares)
                                </h3>
                            </div>

                        <div>
                            <canvas id="lineChart" height="40" width="100%"></canvas>
                        </div>

                        <div class="m-t-md">
                            <small class="pull-right">
                                <i class="fa fa-clock-o"> </i>
                                <i id="fecha_oro"> </i>
                            </small>
                        </div>

                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                            <div>
                                <span class="pull-right text-right">
                                <small>Cotización en tiempo real del precio de la plata en el mercado al contado</small>
                                </span>
                                <h3 class="font-bold no-margins">
                                    Precio de la plata (USD)
                                </h3>
                            </div>

                        <div>
                            <canvas id="plataChart" height="40" width="100%"></canvas>
                        </div>

                        <div class="m-t-md">
                            <small class="pull-right">  
                                <i class="fa fa-clock-o"> </i>                                     
                                <i id="fecha_plata"></i>
                            </small>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        {% if owner_user.tipo == 0 or (owner_user.tipo == 1 and owner_user.id_comercio_afiliado != null ) or  (owner_user.tipo == 3 and owner_user.id_comercio_afiliado != null) %}
        <div class="row">
               <div class="col-lg-12">
                   <div class="ibox float-e-margins">
                       <div class="ibox-title">
                           <h5>Intercambio en comercio afiliado</h5>
                           <div class="ibox-tools">
                                <a class="collapse-link">
                                    <i class="fa fa-chevron-up"></i>
                                </a>
                            </div>
                       </div>
                       <div class="ibox-content" id="intercambioencomercioModal">
                          <form id="crearIntercambioComercio_form">
                            <div class="row">
                                <div class="col-md-3 col-xs-12 clientes_intercambiocomercio">
                                    <div class="form-group">
                                      <label for="id_cliente" class="control-label mb-1" >Clientes</label>
                                      <select name="id_cliente" id="id_cliente" class="form-control selectxxx" style="width: 100%">
                                        <option disabled selected value>Seleccione un cliente</option>
                                        {% for c in clientes %}
                                          <option value="{{c.id_user}}">{{c.primer_nombre}} {{c.primer_apellido}} - {{c.numero_cedula}} - {{c.email}}</option>
                                        {% endfor %}
                                      </select>
                                    </div>
                                </div> 
                            
                                <div class="col-md-3 col-xs-12 tipo_intercambiocomercio">
                                    <div class="form-group">
                                        <label for="id_tipo_int" class="control-label mb-1" >Tipo metal</label>
                                        <select name="tipo_gramo" id="id_tipo_int" class="form-control" style="width: 100%" onchange="resetQuantity('id_cantidad_bolivar_soberano_int','id_tipo_int','id_cantidad_int')">
                                            <option disabled selected value>Tipo</option>
                                            <option value="oro">Oro</option>
                                            <option value="plata">Plata</option>
                                        </select>
                                    </div>                         
                                </div>                    

                                <div class="col-md-3 col-xs-12 cantidadbss_intercambiocomercio">
                                <div class="form-group">
                                    <label for="id_cantidad_bolivar_soberano_int" class="control-label mb-1" >Cantidad BsS</label>
                                    <input placeholder="0.00" name="cantidad_bolivar_soberano" id="id_cantidad_bolivar_soberano_int" type="number" onchange="resetQuantity('id_cantidad_bolivar_soberano_int','id_tipo_int','id_cantidad_int')" class="form-control" >
                                </div>
                                </div>  

                                <div class="col-md-3 col-xs-12 cantidad_intercambiocomercio">
                                <div class="form-group">
                                    <label for="id_cantidad_int" class="control-label mb-1" >Cantidad(gramos)</label>
                                    <input placeholder="0" class="form-control" name="cantidad" id="id_cantidad_int" readonly="readonly" type="number"> 
                                </div>                      
                                </div>
                            </div>  
                          </form>
                          <div class="row">
                            <div style="float:right">
                              <button type="button" id="crearIntercambioEnComercioBtn" class="btn btn-primary" >Crear</button>  
                            </div>
                          </div>
                           
                       </div>
                   </div>
               </div>
        </div>

        
        <div class="row">
                <div class="row">
                   <div class="col-lg-12">
                       <div class="ibox float-e-margins">
                           <div class="ibox-title">
                               <h5>Transacciones realizadas por los comercios afiliados</h5>
                           </div>
                           <div class="ibox-content">
                                <div class="table-responsive">
                                   <table class="table table-striped table-bordered table-hover tablita" >
                                       <thead>
                                       <tr>
                                            <th>Nro orden</th>
                                            <th>Usuario</th>
                                            <th>Vendedor</th>
                                            <th>Comercio afiliado</th>
                                            <th>Sucursal</th>
                                            <th>Composición</th>
                                            <th>Cantidad</th>
                                            <th>Precio</th>
                                            <th>Monto(USD)</th>
                                            <th>Monto(Bss)</th>
                                            <th>Fecha</th>
                                       </tr>
                                       </thead>
                                       <tbody>  
                                           {% for o in ordenes %}
                                           <tr>
                                                <td>{{ o.id_orden }}</td>
                                                <td>{{ o.nombre_usuario }} {{ o.apellido_usuario }}</td>
                                                <td>{{ o.nombre_vendedor }} {{ o.apellido_vendedor }}</td>
                                                <td>{{ o.nombre_afiliado }}</td>
                                                <td>{{ o.sucursal }}</td>
                                                <td>{{ o.tipo_gramo }}</td>
                                                <td>{{ o.cantidad }}</td>
                                                <td>{{ o.precio|number_format(2, ',', '.') }}</td>   
                                                <td>{{ (o.cantidad * o.precio )|number_format(2, ',', '.') }}</td>
                                                <td>{{ (o.cantidad_bolivar_soberano )|number_format(2, ',', '.') }}</td>
                                                <td>{{ fecha('D, d F, Y h:i a', o.fecha) }}</td> 
                                           </tr>
                                           {% endfor %}
                                           
                                       </tbody>
                                   </table>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>
        </div>
        {% endif %}

        {% if owner_user.tipo == 0 %}

        
        <div class="row">
               <div class="col-lg-12">
                   <div class="ibox float-e-margins">
                       <div class="ibox-title">
                           <h5>Cantidad de transacciones realizadas por los comercios afiliados</h5>
                       </div>
                       <div class="ibox-content">
                            <div class="table-responsive">
                               <table id="example" class="table table-striped table-bordered table-hover tablita" >
                                   <thead>
                                   <tr>
                                        <th>Comercio Afiliado</th>
                                        <th>Sucursal</th>
                                        <th>Cantidad</th>
                                   </tr>
                                   </thead>
                                   <tbody>  
                                       {% for ccpc in cantidad_compras_por_comercio %}
                                       <tr>
                                            <td>{{ ccpc.nombre }}</td>
                                            <td>{{ ccpc.sucursal }}</td>
                                            <td>{{ ccpc.cantidad }}</td>
                                       </tr>
                                       {% endfor %}
                                       
                                   </tbody>
                               </table>
                           </div>
                       </div>
                   </div>
               </div>
        </div>
        


        <div class="row">
            <div class="row">
               <div class="col-lg-12">
                   <div class="ibox float-e-margins">
                       <div class="ibox-title">
                           <h5>Gramos poseídos por un comercio afiliado</h5>
                       </div>
                       <div class="ibox-content">
                            <div class="table-responsive">
                               <table class="table table-striped table-bordered table-hover tablita" >
                                   <thead>
                                   <tr>
                                        <th>Comercio Afiliado</th>
                                        <th>Sucursal</th>
                                        <th>Tipo gramo</th>
                                        <th>Cantidad</th>
                                   </tr>
                                   </thead>
                                   <tbody>  
                                       {% for cgc in cantidades_gramos_comercios %}
                                       <tr>
                                            <td>{{ cgc.nombre }}</td>
                                            <td>{{ cgc.sucursal }}</td>
                                            <td>{{ cgc.tipo_gramo }}</td>
                                            <td>{{ cgc.cantidad }}</td>
                                       </tr>
                                       {% endfor %}
                                       
                                   </tbody>
                               </table>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
        </div>


        <div class="row">
            <div class="row">
               <div class="col-lg-12">
                   <div class="ibox float-e-margins">
                       <div class="ibox-title">
                           <h5>Envío de gramos poseídos por un comercio afiliado a Franklin</h5>
                       </div>
                       <div class="ibox-content">
                            <div class="table-responsive">
                               <table class="table table-striped table-bordered table-hover tablita" >
                                   <thead>
                                   <tr>
                                        <th>Comercio Afiliado</th>
                                        <th>Sucursal</th>
                                        <th>Composición</th>
                                        <th>Cantidad</th>
                                        <th>Precio</th>
                                        <th>Monto(USD)</th>
                                        <th>Fecha</th>
                                   </tr>
                                   </thead>
                                   <tbody>  
                                       {% for odc in ordenes_descuentos_comercios %}
                                       <tr>
                                            <td>{{ odc.nombre_afiliado }}</td>
                                            <td>{{ odc.sucursal }}</td>
                                            <td>{{ odc.tipo_gramo }}</td>
                                            <td>{{ odc.cantidad }}</td>
                                            <td>{{ odc.precio|number_format(2, ',', '.') }}</td>   
                                            <td>{{ (odc.cantidad * odc.precio )|number_format(2, ',', '.') }}</td>
                                            <td>{{ fecha('D, d F, Y h:i a', odc.fecha) }}</td> 
                                       </tr>
                                       {% endfor %}
                                       
                                   </tbody>
                               </table>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
        </div>

        {% endif %}

        <div class="row">
                <div class="row">
                   <div class="col-lg-12">
                       <div class="ibox float-e-margins">
                           <div class="ibox-title">
                               <h5>Equivalencias en peso</h5>
                           </div>
                           <div class="ibox-content">
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead>
                                        <tr>
                                            <th>Kilogramos (oz) / Kilograms</th>
                                            <th>Gramos (g) / Grams</th>
                                            <th>Onzas (oz) / Ounces</th>
                                            <th>Penny Weights</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>1</td>
                                                <td>1000</td>
                                                <td>35.3</td>
                                                <td>643.015</td>
                                            </tr>
                                            <tr>
                                                <td>0.001</td>
                                                <td>1</td>
                                                <td>0.035</td>
                                                <td>0.6430</td>
                                            </tr>
                                            <tr>
                                                <td>0.0283</td>
                                                <td>28.3</td>
                                                <td>1</td>
                                                <td>18.1973</td>
                                            </tr>
                                            <tr>
                                                <td>0.453</td>
                                                <td>453</td>
                                                <td>16</td>
                                                <td>291.2857</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                           </div>
                       </div>
                   </div>
               </div>
        </div>


        {% if owner_user.tipo != 1  %}
        <div class="row">

            <div class="col-md-4">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="label label-primary pull-right">Hoy</span>
                        <h5>Ventas Diarias</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">{{ data.diarias.total }}</h1>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="label label-info pull-right">Mensual</span>
                        <h5>Ventas Mensuales</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">{{ data.mensuales.total }}</h1>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <span class="label label-warning pull-right">Anual</span>
                        <h5>Ventas del año</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">{{ data.anuales.total }}</h1>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">

            <div class="col-md-4">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Usuarios registrados en el sistema</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">{{ data.usuarios.total }}</h1>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Dólares de monedas vendidas en oro</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">${{ data.ventas_oro.total|number_format(2,'.',',') }}</h1>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Dólares de monedas vendidas en plata</h5>
                    </div>
                    <div class="ibox-content">
                        <h1 class="no-margins">${{ data.ventas_plata.total|number_format(2,'.',',') }}</h1>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

{% include 'home/confirmarintercambioencomercio' %}
{% include 'home/intercambioencomercio' %}   
{% include 'home/enviargramos' %}   
{% include 'overall/footer' %}
</div>
{% endblock %}

{% block appFooter %}
    <script>
        /**
        * Variables que contienen los precios actuales del oro y de la plata y del BsS
        */
        var ultimo_precio_oro=0;
        var ultimo_precio_plata=0;
        var precio_bolivar_soberano=0;
        $(document).ready(function(){
            
           ultimo_precio_oro ={{ precio_oro_global.precio_dolares_venta }};
           ultimo_precio_plata ={{ precio_plata_global.precio_dolares_venta }};
           precio_bolivar_soberano ={{ precio_bolivar }};
        });     
    </script>
    <script src="./assets/jscontrollers/home/sendgramos.js"></script>
    <script src="./assets/jscontrollers/home/intercambioencomercio.js"></script>
    <script src="./assets/jscontrollers/home/dashboard.js"></script>
{% endblock %}
